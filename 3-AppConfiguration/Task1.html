<!DOCTYPE html>
<html lang="en" class=" is-copy-enabled is-u2f-enabled"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    

    <link crossorigin="anonymous" href="./css/1.css" integrity="sha256-MeNpzNKyOh7M3oPwPvNur/8fe5Al9gQsysM6eRV1PeI=" media="all" rel="stylesheet">
    <link crossorigin="anonymous" href="./css/2.css" integrity="sha256-Qs7rZXUl2oZfgtH3qETzuKtVxDXwVMxiuSkRvumyXpA=" media="all" rel="stylesheet">
    
    
    <link crossorigin="anonymous" href="./css/3.css" integrity="sha256-SKJvLEs/Mt2WVnI/X91VjUL2vMXRO6CkWuAl6ryc2LM=" media="all" rel="stylesheet">
    

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
    <meta name="viewport" content="width=device-width">
    
    <title>Step 3: Configuring basic app features</title>
    <link rel="search" type="application/opensearchdescription+xml" href="https://github.com/opensearch.xml" title="GitHub">
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
    <link rel="apple-touch-icon" href="https://github.com/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="https://github.com/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://github.com/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://github.com/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://github.com/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://github.com/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://github.com/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://github.com/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://github.com/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://github.com/apple-touch-icon-180x180.png">
       <link rel="assets" href="https://assets-cdn.github.com/">
    
      <link rel="mask-icon" href="https://assets-cdn.github.com/pinned-octocat.svg" color="#000000">
      <link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico">

  <body class="logged-out  env-production windows vis-public">

    <div role="main">
        <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode">
    <div id="js-repo-pjax-container" data-pjax-container=""><div class="container new-discussion-timeline experiment-repo-nav">
  <div class="repository-content">


  <div id="readme" class="readme boxed-group clearfix announce instapaper_body md">
    

      <article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-step-2-configuring-basic-app-features" class="anchor" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 3: Configuring basic app features</h1>

<h2><a id="user-content-objectives" class="anchor" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Objectives</h2>

<ul>
<li>Set up configuration files</li>
<li>Set up environment-specific settings</li>
<li>Logging</li>
<li>Dependency injection</li>
</ul>

<h2><a id="user-content-hosting-environment" class="anchor" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hosting environment</h2>

<p>There are a number of things we want happening differently depending what hosting environment we're in, such as showing exceptions in the browser if we're in our development environment or using a specific configuration file per environment. If we don't specify somehow, ASP.NET will default to our hosting environment being "Production". There are a number of ways to set the hosting environment. </p>

<ol>
<li><p>We're going to set the hosting environment to "Development" in our OS's environment variables, so it will default to that. Otherwise you'd have to pass a an argument, when running the app from the command line, to set it to that (you can also set it in Visual Studio and VS Code, see the below blog). </p>

<p>See <a href="http://andrewlock.net/how-to-set-the-hosting-environment-in-asp-net-core/">this blog</a> for how to set the environment variable on your OS. For Windows, run this in Powershell on the project folder,</p>

<pre><code>$Env:ASPNETCORE_ENVIRONMENT = "Development"
</code></pre>

</li>
<li><p>Run <code>dotnet run</code> and see that it says the hosting environment is now development. </p></li>
<li><p>Now we want to set it up so when the hosting environment is development, it will display a detailed exception page in the browser, including header information. </p>

<ol>
<li><p>To do that, first add this dependency: </p>

<pre><code>"Microsoft.AspNetCore.Diagnostics": "1.1.0",
</code></pre></li>
<li><p>Then add  <code>IHostingEnvironment</code> to the Startup.cs <code>Configure</code> method, and use that object to get the environment. Then add the code to check the environment and add the developer exception page middleware:</p>

<pre><code>public void Configure(IApplicationBuilder app, IHostingEnvironment env)
{
    ...
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
    }
    ...
</code></pre></li>
<li><p>You can test it and see the exception page by creating an exception in the pipeline, right under the UseDeveloperExceptionPage:  </p>

<pre><code>app.Run((context) =&gt;
{
    throw new InvalidOperationException("Oops!");
});
</code></pre></li>
<li>Run and browse to the app. You should see the detailed exception page. Otherwise, nothing would be displayed with the 500 response. Remove the exception just added. </li>
</ol></li>
</ol>

<h2><a id="user-content-command-line-arguments" class="anchor" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Command-line arguments</h2>

<p>We're going to need to change the hosting environment locally sometimes. For example, we might want run the Production configuration settings locally while we're developing them. To allow this, we're going to add functionality to pass command-line arguments into our app. </p>

<ol>
<li><p>Add this dependency:</p>
<pre><code>"Microsoft.Extensions.Configuration.CommandLine": "1.1.0"
</code></pre></li>
<li><p>Add this namespace to Program.cs:</p>
<pre><code>using Microsoft.Extensions.Configuration;
</code></pre></li>
<li><p>Add this configuration Program.cs's Main method. You will need to add a using statement:</p>

<pre><code>var config = new ConfigurationBuilder()  
    .AddCommandLine(args)
    .Build();
</code></pre></li>
<li><p>Then add this right before Build() in the WebHostBuilder initialization, so we can use the configuration object we just created: </p>

<pre><code>.UseConfiguration(config)
</code></pre>

<p>Now you can run <code>dotnet run --environment "production"</code> when you want the hosting environment to be that (or you can use staging, etc or your own). </p></li>
</ol>

<h2><a id="user-content-configuration-files" class="anchor" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration files</h2>

<p>Key configuration files in ASP.NET Core include appSettings.json. We're going to add that now, as well as a version for production.</p>

<p>In order to read that and other configuration sources, we have to:</p>

<ol>
<li><p>Add these dependencies:</p>

<pre><code>"Microsoft.Extensions.Configuration.FileExtensions": "1.1.0",
"Microsoft.Extensions.Configuration.Json": "1.1.0"
</code></pre></li>
<li><p>Navigate to <code>Startup.cs</code> and add this namespace:</p>
<pre><code>using Microsoft.Extensions.Configuration;
</code></pre></li>
<li><p>Navigate to <code>Startup.cs</code> and add this:</p>

<pre><code>public IConfigurationRoot Configuration { get; }
...

public Startup(IHostingEnvironment env)
{
  var builder = new ConfigurationBuilder() // Collection of sources for read/write key/value pairs
      .SetBasePath(env.ContentRootPath)
      .AddJsonFile("appSettings.json", optional: true, reloadOnChange: true)
      .AddJsonFile($"appSettings.{env.EnvironmentName}.json", optional: true)
      .AddEnvironmentVariables(); // Overrides environment variables with valiues from config files/etc
  Configuration = builder.Build();
}
</code></pre></li>
<li><p>Add a new file in the root called <code>appSettings.json</code> with this:</p>

<pre><code>{
  "Logging": {
    "IncludeScopes": false,
    "LogLevel": {
      "Default": "Debug",
      "System": "Information",
      "Microsoft": "Information"
    }
  }
}
</code></pre></li>
<li><p>Add an <code>appSettings.Production.json</code> file with the same contents from above, but change the <code>Default</code> value to <code>Information</code>.</p>

<p>We'll use the appSettings later.</p></li>
</ol>

<h2><a id="user-content-logging" class="anchor" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Logging</h2>

<ol>
<li><p>Add the <code>Microsoft.Extensions.Logging.Console</code> package to <code>project.json</code>:</p>

<pre><code>"Microsoft.Extensions.Logging.Console": "1.1.0"
</code></pre></li>
<li><p>Navigate to <code>Startup.cs</code> and Add this namespace</p>
<pre><code>using Microsoft.Extensions.Logging;
</code></pre></li>
<li><p>Navigate to <code>Startup.cs</code> and change the <code>Configure</code> method to:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">void</span> Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
{
    loggerFactory.AddConsole(Configuration.GetSection(<span class="pl-s"><span class="pl-pds">"</span>Logging<span class="pl-pds">"</span></span>));

    <span class="pl-k">var</span> startupLogger = loggerFactory.CreateLogger&lt;Startup&gt;();
    ...</pre></div></li>
<li><p>Add some log statements to the end of the <code>Configure</code> method to test the settings:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">void</span> Configure(IApplicationBuilder app, ILoggerFactory loggerFactory)
{
  ...
    startupLogger.LogTrace(<span class="pl-s"><span class="pl-pds">"</span>Trace test output!<span class="pl-pds">"</span></span>);
    startupLogger.LogDebug(<span class="pl-s"><span class="pl-pds">"</span>Debug test output!<span class="pl-pds">"</span></span>);
    startupLogger.LogInformation(<span class="pl-s"><span class="pl-pds">"</span>Info test output!<span class="pl-pds">"</span></span>);            
    startupLogger.LogError(<span class="pl-s"><span class="pl-pds">"</span>Error test output!<span class="pl-pds">"</span></span>);
    startupLogger.LogCritical(<span class="pl-s"><span class="pl-pds">"</span>Trace test output!<span class="pl-pds">"</span></span>);
}</pre></div></li>
<li><p>Run <code>dotnet restore</code> since we added a package, and then <code>dotnet run</code>. In the console, you should see the all the log statements you just added since in <code>appSettings.json</code> it is set to show debug log entries and more severe.</p></li>
<li><p>Run <code>dotnet run --environment "Production"</code> </p>

<p>You should no longer see the debug log entry in the console, since the <code>appSettings.Production.json</code> is set to only show informational log entries and more severe. Also note that it says the hosting environment in the console, which should be "production". </p></li>
</ol>

<h2><a id="user-content-dependency-injection" class="anchor" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependency Injection</h2>

<p>Here are some key points about the dependency injection that is now baked into ASP.NET Core: </p>

<ul>
<li>ASP.NET Core includes a simple built-in container <em>represented by the IServiceProvider interface</em> that supports constructor injection by default, and ASP.NET makes certain services available through DI.</li>
<li>ASP.NET’s container refers to the types it manages as services.</li>
<li>You configure the built-in container’s services in the ConfigureServices method in your application’s Startup class.</li>
<li>The built-in services container is meant to serve the basic needs of the framework and most consumer applications built on it, but has a minimal feature set and is not intended to replace other containers.</li>
</ul>


</article>
  </div>


  </div>
  
</div></div>
  </div>

    </div>

        



    

    


      
      
      
      
      
      
      
    
    

  


</body></html>